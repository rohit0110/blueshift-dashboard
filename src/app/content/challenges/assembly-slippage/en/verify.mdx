import { ChallengeTitle } from "../../../../components/Challenges/ChallengeTitle";
import { RequirementList } from "../../../../components/Challenges/RequirementList";
import { Requirement } from "../../../../components/Challenges/Requirement";

<ChallengeTitle>sBPF Assembly Slippage</ChallengeTitle>

Now that you are starting to feel comfortable writing Assembly, instead of using just a normal account, your slippage check should work for both SPL-Token and Token2022 Accounts.

> The `amount` will be placed in memory at the same constant as the example. The main difference is that we can't get the instruction data using a constant since the `data_len` of the account is dynamic (instruction data is located at the end of the last account data).

Create a program that only has one instruction. It must:
- Take in a single SPL or Token2022 Token account
- Take in a u64 (8-byte) minimum balance in instruction data
- Dynamically calculate the offset to the minimum balance
- If slippage is exceeded, log the string `Slippage exceeded` and return error code 1

> To get the right instruction data offset you can use our [tool](https://sbpf.xyz). But we're going to help you out: the `data_len` of the token account is at `.equ TOKEN_ACCOUNT_DATA_LEN, 0x0058`

Start by installing the sBPF package like explained in the [tooling section](/en/courses/introduction-to-assembly/tooling) of the Introduction to Assembly course and build your program using the following command in your terminal:

```
sbpf build
```

This will generate a `.so` file in your `target/deploy` folder. 

Now click on the `take challenge` button and drop the file there!


<RequirementList>
  <Requirement title="Challenge 1: Testing the Slippage with SPL-Token">
    Your program should suceed when the amount of token in an SPL-Token Account is higher than the amount passed in.
  </Requirement>

  <Requirement title="Challenge 2: Testing the Failure of a Slippage">
    Your program should fail when the amount of token in an Token Account is lower than the amount passed in.
  </Requirement>

  <Requirement title="Challenge 3: Testing the Slippage with Token2022">
    Your program should suceed when the amount of token in an Token2022 Account is higher than the amount passed in.
  </Requirement>
</RequirementList>